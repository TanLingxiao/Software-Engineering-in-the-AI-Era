# 管理代理自主级别

## 代理自主性连续体

编码代理的自主性不是二元的（自主或不自主），而是一个连续体。理解这个连续体可以帮助你选择合适的自主级别。

## 自主级别分类

### 级别 0：被动助手（Passive Assistant）

代理只响应明确的请求，不采取任何主动行动。

```
用户：帮我写一个函数
代理：[生成函数]

用户：解释这段代码
代理：[解释代码]
```

**特点**：
- 完全被动
- 需要明确的指令
- 不做任何决策
- 不执行任何操作

**适用场景**：
- 简单的问答
- 代码解释
- 文档生成

### 级别 1：主动建议者（Active Advisor）

代理不仅响应请求，还会主动提供建议和改进意见。

```
用户：帮我写一个函数
代理：[生成函数]
代理：我注意到这个函数可以优化。你想看看改进版本吗？
```

**特点**：
- 响应请求
- 主动提供建议
- 等待用户确认
- 不自动执行

**适用场景**：
- 代码审查
- 性能优化
- 最佳实践建议

### 级别 2：协作伙伴（Collaborative Partner）

代理与用户协作完成复杂任务，双方共同决策。

```
用户：我们需要实现用户认证
代理：好的，我建议使用 JWT。你同意吗？
用户：同意
代理：我来实现后端 API，你来实现前端 UI，好吗？
用户：好的
代理：[开始实现]
```

**特点**：
- 共同规划任务
- 分工合作
- 定期同步
- 相互确认

**适用场景**：
- 复杂功能开发
- 重构项目
- 多步骤任务

### 级别 3：半自主执行者（Semi-Autonomous Executor）

代理可以自主执行任务，但关键决策需要用户确认。

```
用户：修复所有 bug
代理：我发现了 5 个 bug。
  1. [bug 1] - 修复方案：[方案]
  2. [bug 2] - 修复方案：[方案]
  ...
  我可以修复这些 bug，你确认吗？
用户：确认
代理：[开始修复]
```

**特点**：
- 自主执行
- 关键决策需确认
- 报告进度
- 可随时中断

**适用场景**：
- Bug 修复
- 测试执行
- 代码重构

### 级别 4：自主代理（Autonomous Agent）

代理完全自主地完成任务，只在必要时通知用户。

```
用户：监控服务器性能，有问题时修复
代理：[自主监控]
代理：[发现性能问题]
代理：[自动修复]
代理：已修复性能问题，详情：[报告]
```

**特点**：
- 完全自主
- 自动决策
- 主动执行
- 结果报告

**适用场景**：
- 监控和维护
- 自动化测试
- CI/CD 流程

### 级别 5：超级自主（Super Autonomous）

代理可以自主规划、执行和优化，甚至可以创建新的代理。

```
用户：构建一个完整的电商平台
代理：[分析需求]
代理：[规划架构]
代理：[创建子代理]
  - 子代理 1：数据库设计
  - 子代理 2：后端 API
  - 子代理 3：前端 UI
  - 子代理 4：测试
代理：[协调子代理]
代理：[完成项目]
```

**特点**：
- 自主规划
- 创建子代理
- 协调执行
- 持续优化

**适用场景**：
- 大型项目
- 复杂系统
- 研究项目

## 选择合适的自主级别

### 决策矩阵

| 任务复杂度 | 风险级别 | 推荐级别 |
|-----------|---------|---------|
| 低 | 低 | 级别 1-2 |
| 低 | 高 | 级别 0-1 |
| 中 | 低 | 级别 2-3 |
| 中 | 高 | 级别 1-2 |
| 高 | 低 | 级别 3-4 |
| 高 | 高 | 级别 2-3 |

### 实际应用示例

#### 示例 1：简单代码生成

```
任务：写一个排序函数
复杂度：低
风险：低
推荐：级别 0-1

用户：写一个快速排序函数
代理：[生成代码]
代理：这个实现可以进一步优化。你想看看吗？
```

#### 示例 2：代码审查

```
任务：审查 PR 中的代码
复杂度：中
风险：中
推荐：级别 1-2

用户：审查这个 PR
代理：[分析代码]
代理：我发现了几个问题：
  1. [问题 1] - 建议修复
  2. [问题 2] - 建议修复
  你想让我修复这些问题吗？
```

#### 示例 3：Bug 修复

```
任务：修复生产环境的 bug
复杂度：高
风险：高
推荐：级别 2-3

用户：修复登录 bug
代理：[分析问题]
代理：我找到了问题所在。修复方案如下：
  [详细方案]
  我可以执行这个修复，你确认吗？
用户：确认
代理：[执行修复]
代理：修复完成，已部署到测试环境
```

#### 示例 4：监控和维护

```
任务：监控服务器性能
复杂度：中
风险：低
推荐：级别 3-4

用户：监控服务器，有问题时自动修复
代理：[开始监控]
代理：[自动检测问题]
代理：[自动修复]
代理：已修复，报告：[详细报告]
```

## 控制机制

### 1. 确认机制

```python
def execute_with_confirmation(action, description):
    print(f"即将执行：{description}")
    confirm = input("确认执行？(y/n): ")
    if confirm.lower() == 'y':
        return action()
    else:
        return "操作已取消"
```

### 2. 回滚机制

```python
def execute_with_rollback(action, rollback):
    try:
        result = action()
        return result
    except Exception as e:
        print(f"执行失败：{e}")
        print("执行回滚...")
        rollback()
        return "已回滚"
```

### 3. 权限控制

```python
PERMISSIONS = {
    'read': True,
    'write': False,
    'execute': False,
    'delete': False
}

def check_permission(action):
    if PERMISSIONS.get(action, False):
        return True
    else:
        raise PermissionError(f"没有 {action} 权限")
```

### 4. 审计日志

```python
def log_action(action, result):
    log_entry = {
        'timestamp': datetime.now(),
        'action': action,
        'result': result,
        'user': get_current_user()
    }
    save_log(log_entry)
```

## 下一步

现在你已经了解了代理自主级别，让我们学习人机协作模式：

→ [人机协作模式](02-human-agent-collaboration.md)
